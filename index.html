<!DOCTYPE html>
<html>

<head>
  <title>Routine Planner</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    html {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      margin: 0;
      background-color: #f0f0f0;
    }

    h1 {
      margin-bottom: 20px;
      text-align: center;
      color: #333;
    }

    .container {
      display: flex;
      flex-direction: column;
      width: 500px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .time-slot {
      display: flex;
      flex-direction: column;
      padding: 20px; /* Added more padding around text */
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      position: relative; /* To position the color input and delete button */
    }

    .time-slot input[type="color"] {
      display: none;
      position: absolute;
      top: 5px;
      right: 5px;
      cursor: pointer; /* Add cursor pointer for hover */
    }

    .time-slot input[type="color"].show {
      display: block;
    }

    .time {
      font-weight: bold;
    }

    .input-group {
      display: none;
      margin-top: 10px;
    }

    .input-group input[type="text"] {
      padding: 5px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
      flex-grow: 1;
    }

    .input-group button {
      padding: 5px 10px;
      border: none;
      border-radius: 3px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }

    ul {
      list-style: none;
      padding: 0;
      margin-top: 10px;
      display: block;
    }

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px; /* Added more padding around text */
      margin-bottom: 5px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    li span {
      flex-grow: 1;
    }

    li button {
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      background-color: #f44336;
      color: white;
      cursor: pointer;
      font-size: 1.2em; /* Make the icon a bit larger */
    }

    .add-time-slot {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .add-time-slot button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background-color: #008CBA;
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Delete buttons initially hidden */
    li button,
    .time-slot button {
      display: none;
    }

    /* Show delete buttons on hover */
    li:hover button,
    .time-slot:hover button {
      display: block;
    }

    /* Show input group on hover */
    .time-slot:hover .input-group {
      display: flex;
    }
  </style>
</head>

<body>
  <h1>My Daily Routine</h1>
  <div class="container">
    <div class="time-slot work" id="timeSlot-8am">
      <span class="time" id="time-8am">8:00 AM</span>
      <input type="color" id="color-8am" onchange="changeSlotColor('8am')" value="#ffffff">
      <div class="input-group">
        <input type="text" id="activity-8am" placeholder="Activity">
        <button onclick="addActivity('8am')">Add</button>
      </div>
      <ul id="activities-8am"></ul>
      <button onclick="deleteTimeSlot('8am')">Delete Time Slot</button>
    </div>
    <div class="add-time-slot">
      <button onclick="addTimeSlot()">Add Time Slot</button>
    </div>
  </div>

  <script>
    let timeSlotCounter = 5; // Keep track of time slot IDs

    document.addEventListener("click", function (event) {
      const colorPickers = document.querySelectorAll('input[type="color"]');
      colorPickers.forEach(colorPicker => {
        if (colorPicker !== event.target) {
          colorPicker.classList.remove('show');
        }
      });
    });

    function addActivity(time, activityValue = null) {
      const activityInput = document.getElementById(`activity-${time}`);
      const activity = activityValue || activityInput.value.trim();

      if (activity !== "") {
        const activitiesList = document.getElementById(`activities-${time}`);
        const newActivity = document.createElement("li");
        newActivity.innerHTML = `
          <span>${activity}</span>
          <button onclick="deleteActivity(this)"><i class="fas fa-trash"></i></button>
        `;
        activitiesList.appendChild(newActivity);
        if (!activityValue) {
          activityInput.value = ""; // Clear the input field if not loading from storage
        }
        saveActivities();
      }
    }

    function deleteActivity(button) {
      const activityItem = button.parentElement;
      activityItem.remove();
      saveActivities();
    }

    function addTimeSlot() {
      timeSlotCounter++;
      const newTimeSlot = document.createElement("div");
      newTimeSlot.classList.add("time-slot");
      newTimeSlot.setAttribute("id", `timeSlot-${timeSlotCounter}`);
      newTimeSlot.innerHTML = `
        <span class="time" id="time-${timeSlotCounter}" contenteditable="true">Time Slot ${timeSlotCounter}</span>
        <input type="color" id="color-${timeSlotCounter}" onchange="changeSlotColor('${timeSlotCounter}')" value="#ffffff">
        <div class="input-group">
          <input type="text" id="activity-${timeSlotCounter}" placeholder="Activity">
          <button onclick="addActivity('${timeSlotCounter}')">Add</button>
        </div>
        <ul id="activities-${timeSlotCounter}"></ul>
        <button onclick="deleteTimeSlot('${timeSlotCounter}')">Delete Time Slot</button>
      `;

      newTimeSlot.style.backgroundColor = "white"; // Default background color to white

      const container = document.querySelector(".container");
      container.insertBefore(newTimeSlot, container.lastElementChild);
      saveActivities();
    }

    function changeSlotColor(time) {
      const timeSlot = document.getElementById(`timeSlot-${time}`);
      const colorInput = document.getElementById(`color-${time}`);
      timeSlot.style.backgroundColor = colorInput.value;
      saveActivities();
    }

    function deleteTimeSlot(time) {
      const timeSlot = document.getElementById(`timeSlot-${time}`);
      timeSlot.remove();
      saveActivities();
    }

    function saveActivities() {
      const activitiesData = {};
      const timeSlots = document.querySelectorAll(".time-slot");

      timeSlots.forEach(timeSlot => {
        const time = timeSlot.id.replace("timeSlot-", "");
        activitiesData[time] = {
          color: document.getElementById(`color-${time}`).value,
          activities: Array.from(timeSlot.querySelector("ul").children).map(li => li.textContent.trim())
        };
      });

      localStorage.setItem("routineActivities", JSON.stringify(activitiesData));
    }

    function loadActivities() {
      const savedActivities = JSON.parse(localStorage.getItem("routineActivities"));
      if (savedActivities) {
        for (const time in savedActivities) {
          if (!document.getElementById(`timeSlot-${time}`)) {
            addTimeSlot(); // Ensure the slot exists before adding activities
          }
          const timeSlot = document.getElementById(`timeSlot-${time}`);
          timeSlot.style.backgroundColor = savedActivities[time].color || "white"; // Default to white if no color saved
          document.getElementById(`color-${time}`).value = savedActivities[time].color || "#ffffff"; // Set color picker value
          savedActivities[time].activities.forEach(activity => addActivity(time, activity));
        }
      }
    }

    document.addEventListener("DOMContentLoaded", loadActivities);

    // Event delegation to handle color picker clicks and keep them open
    document.body.addEventListener("click", function (event) {
      if (event.target.matches('input[type="color"]')) {
        event.target.classList.add('show');
      } else {
        document.querySelectorAll('input[type="color"]').forEach(colorPicker => {
          colorPicker.classList.remove('show');
        });
      }
    });
  </script>
</body>

</html>
